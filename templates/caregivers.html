{% extends "base.html" %}

{% block title %}Caregivers{% endblock %}

{% block content %}
<div class="container">
    <h1>Caregivers</h1>

    {% if not edit_caregiver %}
    <button onclick="document.getElementById('addForm').style.display='block'" class="btn-primary">
        Add New Caregiver
    </button>
    {% endif %}

    <!-- Add Caregiver Form -->
    <div id="addForm" style="display: {% if show_form %}block{% else %}none{% endif %};">
        <h2>Add New Caregiver</h2>
        <form method="post" action="/caregivers/create" class="form">
            <div class="form-group">
                <label>Select User:</label>
                <select name="user_id" required>
                    <option value="">-- Select User --</option>
                    {% for user in users %}
                    <option value="{{ user.user_id }}">{{ user.given_name }} {{ user.surname }} ({{ user.email }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>Photo URL:</label>
                <input type="text" name="photo_url" placeholder="https://example.com/photo.jpg" required>
            </div>
            <div class="form-group">
                <label>Gender:</label>
                <select name="gender" required>
                    <option value="">-- Select Gender --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Caregiving Type:</label>
                <select name="caregiving_type" required>
                    <option value="">-- Select Type --</option>
                    <option value="Babysitter">Babysitter</option>
                    <option value="Caregiver">Caregiver</option>
                    <option value="Special Needs">Special Needs</option>
                    <option value="Tutor">Tutor</option>
                </select>
            </div>
            <div class="form-group">
                <label>Hourly Rate (₸):</label>
                <input type="number" name="hourly_rate" step="0.01" min="0" placeholder="2000.00" required>
            </div>
            <button type="submit" class="btn-primary">Save Caregiver</button>
            <button type="button" onclick="document.getElementById('addForm').style.display='none'" class="btn-secondary">Cancel</button>
        </form>
    </div>

    <!-- Edit Caregiver Form -->
    {% if edit_caregiver %}
    <div id="editForm">
        <h2>Edit Caregiver</h2>
        <form method="post" action="/caregivers/edit/{{ edit_caregiver.caregiver_id }}" class="form">
            <div class="form-group">
                <label>User:</label>
                <input type="text" value="{{ edit_caregiver.user.given_name }} {{ edit_caregiver.user.surname }}" disabled>
                <input type="hidden" name="user_id" value="{{ edit_caregiver.user_id }}">
            </div>
            <div class="form-group">
                <label>Photo URL:</label>
                <input type="text" name="photo_url" value="{{ edit_caregiver.photo_url }}" required>
            </div>
            <div class="form-group">
                <label>Gender:</label>
                <select name="gender" required>
                    <option value="Male" {% if edit_caregiver.gender == 'Male' %}selected{% endif %}>Male</option>
                    <option value="Female" {% if edit_caregiver.gender == 'Female' %}selected{% endif %}>Female</option>
                    <option value="Other" {% if edit_caregiver.gender == 'Other' %}selected{% endif %}>Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Caregiving Type:</label>
                <select name="caregiving_type" required>
                    <option value="Babysitter" {% if edit_caregiver.caregiving_type == 'Babysitter' %}selected{% endif %}>Babysitter</option>
                    <option value="Caregiver" {% if edit_caregiver.caregiving_type == 'Caregiver' %}selected{% endif %}>Caregiver</option>
                    <option value="Special Needs" {% if edit_caregiver.caregiving_type == 'Special Needs' %}selected{% endif %}>Special Needs</option>
                    <option value="Tutor" {% if edit_caregiver.caregiving_type == 'Tutor' %}selected{% endif %}>Tutor</option>
                </select>
            </div>
            <div class="form-group">
                <label>Hourly Rate (₸):</label>
                <input type="number" name="hourly_rate" step="0.01" value="{{ edit_caregiver.hourly_rate }}" required>
            </div>
            <button type="submit" class="btn-primary">Update Caregiver</button>
            <a href="/caregivers" class="btn-secondary">Cancel</a>
        </form>
    </div>
    {% endif %}

    <!-- Caregivers List -->
    <h2>All Caregivers ({{ caregivers|length }})</h2>
    {% if caregivers %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Gender</th>
                <th>Type</th>
                <th>Hourly Rate</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for caregiver in caregivers %}
            <tr>
                <td>{{ caregiver.caregiver_id }}</td>
                <td>{{ caregiver.user.given_name }} {{ caregiver.user.surname }}</td>
                <td>{{ caregiver.user.email }}</td>
                <td>{{ caregiver.gender }}</td>
                <td>{{ caregiver.caregiving_type }}</td>
                <td>₸{{ caregiver.hourly_rate }}</td>
                <td>
                    <a href="/caregivers/edit/{{ caregiver.caregiver_id }}" class="btn-small btn-primary">Edit</a>
                    <a href="/caregivers/delete/{{ caregiver.caregiver_id }}"
                       onclick="return confirm('Delete this caregiver?')"
                       class="btn-small btn-danger">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No caregivers found. Add your first caregiver!</p>
    {% endif %}
</div>

<script>
// Auto-hide add form after showing caregivers list
if (document.querySelectorAll('table tbody tr').length > 0) {
    document.getElementById('addForm').style.display = 'none';
}
</script>
{% endblock %}