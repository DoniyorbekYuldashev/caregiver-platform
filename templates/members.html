{% extends "base.html" %}

{% block title %}Members{% endblock %}

{% block content %}
<div class="container">
    <h1>Members</h1>

    {% if not edit_member %}
    <button onclick="document.getElementById('addForm').style.display='block'" class="btn btn-primary">
        Add New Member
    </button>
    {% endif %}

    <!-- Add Member Form -->
    <div id="addForm" style="display: {% if show_form %}block{% else %}none{% endif %};">
        <h2>Add New Member</h2>
        <form method="post" action="/members/create">
            <div class="form-group">
                <label>Select User:</label>
                <select name="user_id" required>
                    <option value="">-- Select User --</option>
                    {% for user in users %}
                    <option value="{{ user.user_id }}">{{ user.given_name }} {{ user.surname }} ({{ user.email }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>House Rules:</label>
                <textarea name="house_rules" rows="4" placeholder="Enter house rules..." required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Save Member</button>
            <button type="button" onclick="document.getElementById('addForm').style.display='none'" class="btn btn-secondary">Cancel</button>
        </form>
    </div>

    <!-- Edit Member Form -->
    {% if edit_member %}
    <div id="editForm">
        <h2>Edit Member</h2>
        <form method="post" action="/members/edit/{{ edit_member.member_id }}">
            <div class="form-group">
                <label>User:</label>
                <input type="text" value="{{ edit_member.user.given_name }} {{ edit_member.user.surname }}" disabled>
            </div>
            <div class="form-group">
                <label>House Rules:</label>
                <textarea name="house_rules" rows="4" required>{{ edit_member.house_rules }}</textarea>
            </div>
            <button type="submit" class="btn btn-primary">Update Member</button>
            <a href="/members" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
    {% endif %}

    <!-- Members List -->
    <h2>All Members ({{ members|length }})</h2>
    {% if members %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>City</th>
                <th>Phone</th>
                <th>House Rules</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for member in members %}
            <tr>
                <td>{{ member.member_id }}</td>
                <td>{{ member.user.given_name }} {{ member.user.surname }}</td>
                <td>{{ member.user.email }}</td>
                <td>{{ member.user.city }}</td>
                <td>{{ member.user.phone_number }}</td>
                <td>{{ member.house_rules[:50] }}{% if member.house_rules|length > 50 %}...{% endif %}</td>
                <td>
                    <a href="/members/edit/{{ member.member_id }}" class="btn btn-primary">Edit</a>
                    <a href="/members/delete/{{ member.member_id }}"
                       onclick="return confirm('Delete this member?')"
                       class="btn btn-danger">üóëÔ∏è Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No members found. Add your first member!</p>
    {% endif %}
</div>

<script>
// Auto-hide add form when showing list
if (document.querySelectorAll('table tbody tr').length > 0) {
    document.getElementById('addForm').style.display = 'none';
}
</script>
{% endblock %}