{% extends "base.html" %}

{% block title %}Users{% endblock %}

{% block content %}
<div class="container">
    <h1>Users</h1>

    {% if not edit_user %}
    <button onclick="document.getElementById('addForm').style.display='block'" class="btn-primary">
         Add New User
    </button>
    {% endif %}

    <!-- Add User Form -->
    <div id="addForm" style="display: {% if show_form %}block{% else %}none{% endif %};">
        <h2>Add New User</h2>
        <form method="post" action="/users/create" class="form">
            <div class="form-group">
                <label>Email:</label>
                <input type="email" name="email" required>
            </div>
            <div class="form-group">
                <label>First Name:</label>
                <input type="text" name="given_name" required>
            </div>
            <div class="form-group">
                <label>Last Name:</label>
                <input type="text" name="surname" required>
            </div>
            <div class="form-group">
                <label>City:</label>
                <input type="text" name="city" required>
            </div>
            <div class="form-group">
                <label>Phone:</label>
                <input type="text" name="phone_number" required>
            </div>
            <div class="form-group">
                <label>Profile Description:</label>
                <textarea name="profile_description" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" name="password" required>
            </div>
            <button type="submit" class="btn-primary">Save User</button>
            <button type="button" onclick="document.getElementById('addForm').style.display='none'" class="btn-secondary">Cancel</button>
        </form>
    </div>

    <!-- Edit User Form -->
    {% if edit_user %}
    <div id="editForm">
        <h2>Edit User</h2>
        <form method="post" action="/users/edit/{{ edit_user.user_id }}" class="form">
            <div class="form-group">
                <label>Email:</label>
                <input type="email" name="email" value="{{ edit_user.email }}" required>
            </div>
            <div class="form-group">
                <label>First Name:</label>
                <input type="text" name="given_name" value="{{ edit_user.given_name }}" required>
            </div>
            <div class="form-group">
                <label>Last Name:</label>
                <input type="text" name="surname" value="{{ edit_user.surname }}" required>
            </div>
            <div class="form-group">
                <label>City:</label>
                <input type="text" name="city" value="{{ edit_user.city }}" required>
            </div>
            <div class="form-group">
                <label>Phone:</label>
                <input type="text" name="phone_number" value="{{ edit_user.phone_number }}" required>
            </div>
            <div class="form-group">
                <label>Profile Description:</label>
                <textarea name="profile_description" rows="3" required>{{ edit_user.profile_description }}</textarea>
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" name="password" value="{{ edit_user.password }}" required>
            </div>
            <button type="submit" class="btn-primary">Update User</button>
            <a href="/users" class="btn-secondary">Cancel</a>
        </form>
    </div>
    {% endif %}

    <!-- Users List -->
    <h2>All Users ({{ users|length }})</h2>
    {% if users %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>City</th>
                <th>Phone</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.user_id }}</td>
                <td>{{ user.given_name }} {{ user.surname }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.city }}</td>
                <td>{{ user.phone_number }}</td>
                <td>
                    <a href="/users/edit/{{ user.user_id }}" class="btn-small btn-primary">Edit</a>
                    <a href="/users/delete/{{ user.user_id }}"
                       onclick="return confirm('Delete this user?')"
                       class="btn-small btn-danger">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No users found. Add your first user!</p>
    {% endif %}
</div>
{% endblock %}